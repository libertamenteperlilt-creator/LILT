<!doctype html>
<html lang="it">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <title>Amiche per la LILT — Iscrizione</title>
  <style>
    :root{
      --pink:#e91e63; --red:#d32f2f; --black:#000; --white:#fff;
      --muted:#c2c2c2; --border:#222; --panel:#0f0f12;
    }
    *{box-sizing:border-box}
    html,body{margin:0;padding:0;background:var(--black);color:var(--white)}
    body{font-family:Inter,system-ui,Arial,sans-serif; line-height:1.35; overflow-x:hidden}

    .wrap{max-width:880px;margin:16px auto;background:var(--panel);
      padding:20px;border-radius:16px;box-shadow:0 8px 24px rgba(0,0,0,.5); border:1px solid var(--border)}
    header{display:flex;align-items:center;gap:12px;background:#000;padding:12px;border-radius:12px;margin-bottom:16px;border:1px solid var(--border); flex-wrap:wrap}
    .header-logos{display:flex;align-items:center;gap:10px;flex:1 1 auto;min-width:0}
    .logo-plain img,
    .logo-pill-white img{
      display:block;
      height:auto;
      max-height:42px;
      width:auto;
      max-width:100%;
      object-fit:contain;
    }
    .logo-pill-white{background:#fff;border-radius:12px;padding:6px 15px;display:inline-flex;align-items:center;box-shadow:0 2px 8px rgba(0,0,0,.6);max-width:100%}
    .brand{flex:1 1 220px; text-align:right;color:#fff;min-width:0}
    .brand h1{margin:0;font-size:22px;font-weight:800;letter-spacing:.2px}
    .brand span{color:var(--pink);font-weight:700}
    .badge{display:inline-block;background:linear-gradient(90deg,var(--pink),var(--red));color:#fff;padding:4px 10px;border-radius:999px;font-size:12px;font-weight:700;margin-top:6px}

    h2{margin:14px 0 8px;font-size:20px}
    .grid{display:grid;gap:12px}
    @media(min-width:640px){.grid.two{grid-template-columns:1fr 1fr}}

    label{font-weight:700; display:block; margin-bottom:4px}
    input[type="text"], input[type="email"]{
      width:100%; padding:12px; border:1px solid #aaa; border-radius:12px;
      font-size:16px; background:#fff; color:#000;
    }
    input::placeholder{color:#777}

    .card{border:1px solid var(--border);border-radius:14px;padding:14px;background:#0b0b0e}
    .consenso{display:flex;gap:10px;align-items:flex-start;margin:8px 0}
    .consenso input[type="checkbox"]{
      width:20px;height:20px; margin-top:2px; accent-color: var(--pink);
      flex:0 0 auto;
    }
    .btns{display:flex;gap:10px;margin-top:14px;flex-wrap:wrap}
    button{padding:12px 16px;border:0;border-radius:12px;cursor:pointer;font-weight:800;font-size:16px}
    .primary{background:linear-gradient(90deg,var(--pink),var(--red));color:#fff}
    .ghost{background:#1a1a1f;color:#fff;border:1px solid var(--border)}

    .err{color:#ff6b6b;margin-top:8px;font-weight:800}
    .success{background:#0e2a17;border:1px solid #1f7a3e;color:#b6f0c9;padding:12px;border-radius:10px;margin-top:12px}
    .muted{color:var(--muted);font-size:14px}

    .schedule{display:grid;gap:8px;margin:6px 0}
    .slot{display:flex;align-items:center;gap:10px;border:1px solid var(--border);border-left:5px solid var(--pink);padding:10px;border-radius:10px;background:#0b0b0e}
    .slot time{font-weight:900;width:64px}
    .slot .type{font-weight:800}
    .divider{height:1px;background:var(--border);margin:12px 0}
    .step{display:none}
    .step.active{display:block}
    footer{margin-top:24px;font-size:12px;color:#9a9a9a;text-align:center}

    @media (max-width:600px){
      .wrap{padding:14px}
      .brand{flex:1 1 100%; text-align:center}
      .header-logos{justify-content:center; width:100%}
      .btns button{width:100%}
      .logo-plain img, .logo-pill-white img{max-height:36px}
      h2{font-size:18px}
    }
  </style>
</head>
<body>
  <div class="wrap">
    <header>
      <div class="header-logos">
        <span class="logo-plain"><img src="logo1.webp" alt="Logo 1"></span>
        <span class="logo-pill-white"><img src="logo2.png" alt="Logo 2"></span>
      </div>
      <div class="brand">
        <h1><span>Amiche</span> per la LILT</h1>
        <div class="badge">Iscrizione ufficiale</div>
      </div>
    </header>

    <!-- Orari sempre visibili -->
    <section class="card">
      <h2>Calendario lezioni</h2>
      <p class="muted">Le lezioni si selezionano <strong>dopo</strong> aver inserito i dati e i consensi (max 2).</p>
      <div class="schedule">
        <div class="slot"><time>09:00</time><div><div class="type">Yoga</div><div class="muted">con Angela</div></div></div>
        <div class="slot"><time>10:00</time><div><div class="type">Pilates</div><div class="muted">con Valeria</div></div></div>
        <div class="slot"><time>11:00</time><div><div class="type">Pilates</div><div class="muted">con Daniela</div></div></div>
        <div class="slot"><time>14:00</time><div><div class="type">Pilates</div><div class="muted">con Debora</div></div></div>
        <div class="slot"><time>15:00</time><div><div class="type">Pilates</div><div class="muted">con Mara</div></div></div>
        <div class="slot"><time>16:00</time><div><div class="type">Yoga</div><div class="muted">con Valentina</div></div></div>
      </div>
    </section>

    <div class="divider"></div>

    <!-- STEP 1: Dati + Consensi -->
    <section id="step1" class="step active">
      <h2>1) Dati partecipante</h2>
      <div class="grid two">
        <div><label for="nome">Nome *</label><input id="nome" type="text" autocomplete="given-name" required></div>
        <div><label for="cognome">Cognome *</label><input id="cognome" type="text" autocomplete="family-name" required></div>
        <div style="grid-column:1/-1"><label for="email">Email *</label><input id="email" type="email" autocomplete="email" required></div>
      </div>
      <div class="card" style="margin-top:10px">
        <h3 style="margin:0 0 6px">Consensi</h3>
        <div class="consenso">
          <input id="consenso_dati" type="checkbox" required aria-required="true">
          <label for="consenso_dati">Acconsento al trattamento dei dati personali (GDPR). *</label>
        </div>
        <div class="consenso">
          <input id="consenso_media" type="checkbox" required aria-required="true">
          <label for="consenso_media">Acconsento all’utilizzo di immagini e riprese video. *</label>
        </div>
        <p class="muted">Entrambi i consensi sono obbligatori per partecipare.</p>
      </div>
      <div id="err1" class="err" style="display:none;"></div>
      <div class="btns"><button class="primary" id="toStep2">Prosegui alla scelta lezioni</button></div>
    </section>

    <!-- STEP 2: Scelta lezioni (max 2) + invio -->
    <section id="step2" class="step">
      <h2>2) Scegli fino a 2 lezioni</h2>
      <div class="grid">
        <label><input type="checkbox" class="lesson" value="09:00 | Yoga con Angela"> 09:00 — Yoga con Angela</label>
        <label><input type="checkbox" class="lesson" value="10:00 | Pilates con Valeria"> 10:00 — Pilates con Valeria</label>
        <label><input type="checkbox" class="lesson" value="11:00 | Pilates con Daniela"> 11:00 — Pilates con Daniela</label>
        <label><input type="checkbox" class="lesson" value="14:00 | Pilates con Debora"> 14:00 — Pilates con Debora</label>
        <label><input type="checkbox" class="lesson" value="15:00 | Pilates con Mara"> 15:00 — Pilates con Mara</label>
        <label><input type="checkbox" class="lesson" value="16:00 | Yoga con Valentina"> 16:00 — Yoga con Valentina</label>
      </div>
      <div id="err2" class="err" style="display:none;"></div>
      <div class="btns"><button class="ghost" id="back">Indietro</button><button class="primary" id="submit">Invia iscrizione</button></div>
      <div id="ok" class="success" style="display:none;"></div>
    </section>

    <footer>© Amiche per la LILT</footer>
  </div>

  <script>
    // ======= CONFIG =======
    const BACKEND_URL = "https://script.google.com/macros/s/AKfycbwpT0IQePMKhE0NXW0JNFjtljzYj26R0BzH1_M_t0o4YVAT-lqtodSb4dX0Jo3_vUpT/exec";
    const ADMIN_KEY   = "Liberamente2025!";

    // ======= UI logic =======
    const step1=document.getElementById('step1'), step2=document.getElementById('step2');

    document.getElementById('toStep2').addEventListener('click',()=>{
      const nome=document.getElementById('nome').value.trim();
      const cognome=document.getElementById('cognome').value.trim();
      const email=document.getElementById('email').value.trim();
      const cDati=document.getElementById('consenso_dati').checked;
      const cMedia=document.getElementById('consenso_media').checked;
      const err=document.getElementById('err1'); err.style.display='none'; err.textContent='';

      if(!nome||!cognome||!email){
        err.textContent='Compila Nome, Cognome ed Email.'; err.style.display='block'; return;
      }
      if(!cDati || !cMedia){
        err.textContent='Devi acconsentire sia al trattamento dati che a foto e video.'; 
        err.style.display='block'; return;
      }
      step1.classList.remove('active'); 
      step2.classList.add('active'); 
      window.scrollTo({top:0,behavior:'smooth'});
    });

    document.getElementById('back').addEventListener('click',()=>{
      step2.classList.remove('active'); step1.classList.add('active'); window.scrollTo({top:0,behavior:'smooth'});
    });

    // Max 2 lezioni
    const lessonBoxes=document.querySelectorAll('.lesson');
    lessonBoxes.forEach(cb=>{
      cb.addEventListener('change',()=>{
        const selected=[...lessonBoxes].filter(x=>x.checked);
        if(selected.length>2){cb.checked=false;alert('Puoi selezionare al massimo 2 lezioni.');}
      });
    });

    document.getElementById('submit').addEventListener('click',async()=>{
      const nome=document.getElementById('nome').value.trim();
      const cognome=document.getElementById('cognome').value.trim();
      const email=document.getElementById('email').value.trim();
      const consenso_dati=document.getElementById('consenso_dati').checked;
      const consenso_media=document.getElementById('consenso_media').checked;
      const selected=[...lessonBoxes].filter(x=>x.checked).map(x=>x.value);

      const err=document.getElementById('err2'), ok=document.getElementById('ok');
      err.style.display='none'; ok.style.display='none';

      if(selected.length===0||selected.length>2){
        err.textContent='Seleziona 1 o 2 lezioni.';err.style.display='block';return;
      }

      // text/plain per evitare preflight CORS su mobile
      const payload={action:"register", key:ADMIN_KEY, data:{nome,cognome,email,consenso_dati,consenso_media,lezioni:selected}};
      try{
        const res=await fetch(BACKEND_URL,{
          method:'POST',
          headers:{ 'Content-Type':'text/plain;charset=utf-8' },
          body: JSON.stringify(payload)
        });
        const json=await res.json();
        if(json.ok){
          ok.innerHTML="<strong>Iscrizione inviata!</strong> Ti abbiamo mandato una mail con il riepilogo.";
          ok.style.display='block';
          lessonBoxes.forEach(x=>x.disabled=true);
        }else{
          err.textContent=json.error||'Errore durante l’invio.'; err.style.display='block';
        }
      }catch(e){
        err.textContent='Errore di rete o backend non raggiungibile.'; err.style.display='block';
      }
    });
  </script>
</body>
</html>



